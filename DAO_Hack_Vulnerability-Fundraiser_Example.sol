// Smart Contract with the same vulneribility as the 2016 DAO hack and how the attacker expoited it.


// Vulnerable contract.
    pragma solidity ^0.4.8;

    contract Fundraiser{
        
            // Attaching ether balances to each contributing address.
        mapping  (address => uint) balances;
    
            // Making contributions and updating balances.
        function contribute() payable{
            balances[msg.sender] += msg.value;
        }
        
            // Checking contributions from senders address and throws error if balance is zero but if 
            // they have a non-zero balance then they are allowed to withdraw up to their balance.
        function withdraw(){
            if(balances[msg.sender] == 0){
                throw;
            }
            
// Vulnerable Code Here
                // Vulnerable because updating balance does not come until AFTER withdrawl is carried out.
            if(msg.sender.call.value(balances[msg.sender])()){
                balances[msg.sender] = 0;
            }
            else{
                throw;
            }
        }
    
            // Amount of funds in Fundraiser contract
        function getFunds() returns (uint){
            return address(this).balance;
        }
    
    }

